<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Outil simple de migration de favoris FreshRSS vers Feedbin</title>
    
    <!-- Security Headers -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https://freshrss.org https://assets.feedbin.com; font-src 'self'; connect-src 'self' https://api.feedbin.com;">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
    <meta http-equiv="Permissions-Policy" content="geolocation=(), microphone=(), camera=()">
    <link rel="icon" type="image/svg+xml" href="../../../shared/assets/favicon.svg">
    <link rel="icon" type="image/x-icon" href="../../../shared/assets/favicon.ico">
    <link rel="stylesheet" href="../../../shared/design-system/variables.css">
    <link rel="stylesheet" href="../../../shared/design-system/base.css">
    <link rel="stylesheet" href="../../../shared/design-system/components.css">
    <link rel="stylesheet" href="../../../shared/design-system/utilities.css">
    <link rel="stylesheet" href="../../../shared/components/Button/Button.css">
    
    <!-- Shared Components -->
    <script type="module">
        // Import shared components for dynamic use
        import Button from '../../../shared/components/Button/Button.js';
        import Card from '../../../shared/components/Card/Card.js';
        import Message from '../../../shared/components/Message/Message.js';
        import Modal from '../../../shared/components/Modal/Modal.js';
        import Loader from '../../../shared/components/Loader/Loader.js';
        import { ProgressBar, ProgressContainer } from '../../../shared/components/Progress/index.js';
        import Header from '../../../shared/components/Header/Header.js';
        import Footer from '../../../shared/components/Footer/Footer.js';
        
        // Make components available globally
        window.SharedComponents = {
            Button,
            Card,
            Message,
            Modal,
            Loader,
            ProgressBar,
            ProgressContainer,
            Header,
            Footer
        };
    </script>
</head>
<body>
    <!-- Skip link pour navigation clavier -->
    <a href="#main-content" class="skip-link">Aller au contenu principal</a>
    <!-- Page de chargement -->
    <div id="loading" class="loading hidden" role="status" aria-live="polite" aria-label="Chargement en cours">
        <div class="spinner" aria-hidden="true"></div>
        <p>Connexion en cours...</p>
    </div>

    <!-- Formulaire d'authentification -->
    <div id="login-container" class="login-container" role="main">
        <div class="login-card">
            <!-- Header avec logos et fl√®che de migration -->
            <div class="migration-header">
                <div class="logo-container">
                    <div class="logo-item">
                        <img src="https://freshrss.org/images/icon.svg" alt="FreshRSS" class="service-logo" loading="lazy">
                        <span class="service-name">FreshRSS</span>
                    </div>
                    <div class="migration-arrow">
                        <span class="arrow-simple">‚Üí</span>
                    </div>
                    <div class="logo-item">
                        <img src="https://assets.feedbin.com/assets-site/images/icon-manifest.png" alt="Feedbin" class="service-logo" loading="lazy">
                        <span class="service-name">Feedbin</span>
                    </div>
                </div>
                <h1>Outil de migration FreshRSS vers Feedbin</h1>
                <p class="subtitle">Transf√©rez simplement vos articles favoris de FreshRSS vers Feedbin par √©tapes grace √† l'API Feedbin.</p>
            </div>

            <!-- Message containers (will be populated dynamically) -->
            <div id="error-message-container" role="alert" aria-live="assertive" aria-atomic="true"></div>
            <div id="success-message-container" role="status" aria-live="polite" aria-atomic="true"></div>

            <!-- Instructions am√©lior√©es -->
            <div class="instructions">
                <h3>üìã Comment proc√©der :</h3>
                <ol>
                    <li><strong>Connectez-vous</strong> avec vos identifiants Feedbin</li>
                    <li><strong>Exportez vos favoris</strong> depuis FreshRSS (fichier <code>starred_entries.json</code>) - <a href="https://freshrss.github.io/FreshRSS/en/users/04_Subscriptions.html#import--export" target="_blank" rel="noopener">üìñ Doc officielle de FreshRSS</a></li>
                    <li><strong>Uploadez le fichier</strong> dans l'interface de l'app</li>
                    <li><strong>Lancez la migration</strong> automatique vers Feedbin</li>
                </ol>
                
                <div class="help-links">
                    <a href="https://github.com/jaz-on/ai-jaztools" target="_blank" class="github-link">
                        ‚ÑπÔ∏è Plus d'informations sur le d√©p√¥t Github
                    </a>
                </div>
            </div>

            <form id="login-form" class="login-form" role="form" aria-label="Formulaire de connexion Feedbin">
                <div class="input-group">
                    <label for="email">
                        üìß Email Feedbin
                        <span class="required" aria-label="obligatoire">*</span>
                    </label>
                    <input 
                        type="email" 
                        id="email" 
                        name="email" 
                        required 
                        aria-required="true"
                        aria-invalid="false"
                        aria-describedby="email-error email-instructions"
                        placeholder="votre-email@example.com" 
                        autocomplete="username"
                    >
                    <span id="email-instructions" class="instructions sr-only">
                        Entrez votre adresse email Feedbin
                    </span>
                    <span id="email-error" class="error-message" role="alert" aria-live="polite"></span>
                </div>

                <div class="input-group">
                    <label for="password">
                        üîë Mot de passe Feedbin
                        <span class="required" aria-label="obligatoire">*</span>
                    </label>
                    <input 
                        type="password" 
                        id="password" 
                        name="password" 
                        required 
                        aria-required="true"
                        aria-invalid="false"
                        aria-describedby="password-error password-instructions"
                        placeholder="Votre mot de passe Feedbin" 
                        autocomplete="current-password"
                    >
                    <span id="password-instructions" class="instructions sr-only">
                        Entrez votre mot de passe Feedbin
                    </span>
                    <span id="password-error" class="error-message" role="alert" aria-live="polite"></span>
                </div>

                <button type="submit" class="btn btn-primary" aria-label="Se connecter et commencer la migration">
                    <span class="btn-text">üöÄ Commencer la migration</span>
                    <span class="btn-loading hidden" aria-hidden="true">Connexion...</span>
                </button>
            </form>

            <div class="security-info">
                <h3>üîí S√©curit√© garantie</h3>
                <ul>
                    <li>‚úÖ Vos identifiants ne sont <strong>jamais stock√©s</strong></li>
                    <li>‚úÖ Communication <strong>directe</strong> avec l'API Feedbin</li>
                    <li>‚úÖ Session <strong>locale uniquement</strong></li>
                    <li>‚úÖ Code source <strong>auditable</strong> sur GitHub</li>
                </ul>
            </div>
        </div>
        
        <!-- Footer -->
        <footer class="app-footer" role="contentinfo">
            <p>
                Un mini-projet de <a href="https://jasonrouet.com" target="_blank" rel="noopener" aria-label="Site web de Jason Rouet (ouvre dans un nouvel onglet)">Jason Rouet</a>
            </p>
        </footer>
    </div>

    <!-- Dashboard principal -->
    <div id="dashboard" class="dashboard hidden">
        <!-- Navigation -->
        <nav class="navbar" role="navigation" aria-label="Navigation principale">
            <div class="container">
                <div class="nav-content">
                    <div class="nav-brand">
                        <div class="nav-logo">
                            <img src="https://freshrss.org/images/icon.svg" alt="FreshRSS" class="nav-service-logo" loading="lazy">
                            <span class="nav-arrow">‚Üí</span>
                            <img src="https://assets.feedbin.com/assets-site/images/icon-manifest.png" alt="Feedbin" class="nav-service-logo" loading="lazy">
                        </div>
                        <h1>Migration FreshRSS ‚Üí Feedbin</h1>
                    </div>
                    <div class="nav-actions">
                        <span id="user-email" class="user-info" aria-live="polite"></span>
                        <button id="logout-btn" class="btn btn-secondary" aria-label="Se d√©connecter">D√©connexion</button>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Navigation par onglets -->
        <div class="tab-navigation" role="tablist" aria-label="Navigation par onglets">
            <div class="container">
                <button 
                    class="tab-btn active" 
                    data-tab="migration"
                    role="tab"
                    aria-selected="true"
                    aria-controls="migration"
                    id="tab-migration"
                >
                    üöÄ Migration
                </button>
                <button 
                    class="tab-btn" 
                    data-tab="activity"
                    role="tab"
                    aria-selected="false"
                    aria-controls="activity"
                    id="tab-activity"
                    tabindex="-1"
                >
                    üìä Mon activit√©
                </button>
                <button 
                    class="tab-btn" 
                    data-tab="preferences"
                    role="tab"
                    aria-selected="false"
                    aria-controls="preferences"
                    id="tab-preferences"
                    tabindex="-1"
                >
                    ‚öôÔ∏è Mes pr√©f√©rences
                </button>
                <button 
                    class="tab-btn admin-only" 
                    data-tab="admin" 
                    style="display: none;"
                    role="tab"
                    aria-selected="false"
                    aria-controls="admin"
                    id="tab-admin"
                    tabindex="-1"
                >
                    üîß Administration
                </button>
            </div>
        </div>

        <!-- Contenu principal -->
        <main id="main-content" class="main-content" role="main">
            <div class="container">
            <!-- Onglet Migration -->
            <section id="migration" class="tab-content active" role="tabpanel" aria-labelledby="tab-migration" tabindex="0">
                <div class="steps-container">
                    <div class="step" id="step-1">
                        <div class="step-header">
                            <div class="step-number">1</div>
                            <h2>üìÅ Charger les donn√©es FreshRSS</h2>
                        </div>
                        <div class="step-content">
                            <p>S√©lectionnez votre fichier <code>starred_entries.json</code> export√© depuis FreshRSS.</p>
                            
                            <div class="file-upload">
                                <input 
                                    type="file" 
                                    id="freshrss-file" 
                                    accept=".json" 
                                    class="file-input"
                                    aria-describedby="file-instructions file-info"
                                    aria-invalid="false"
                                >
                                <label for="freshrss-file" class="file-label">
                                    üìÑ Choisir le fichier JSON
                                </label>
                                <span id="file-instructions" class="instructions">
                                    S√©lectionnez le fichier starred_entries.json export√© depuis FreshRSS
                                </span>
                                <div id="file-info" class="file-info hidden" aria-live="polite" aria-atomic="true"></div>
                            </div>

                            <div id="freshrss-analysis" class="analysis-results hidden"></div>
                        </div>
                    </div>

                    <div class="step" id="step-2">
                        <div class="step-header">
                            <div class="step-number">2</div>
                            <h2>üîç Analyser les abonnements Feedbin</h2>
                        </div>
                        <div class="step-content">
                            <p>R√©cup√©ration de vos abonnements Feedbin pour pr√©parer la migration.</p>
                            
                            <button 
                                id="analyze-feedbin" 
                                class="btn btn-primary" 
                                disabled
                                aria-label="Analyser les abonnements Feedbin"
                                aria-describedby="analyze-feedbin-instructions"
                            >
                                üîç Analyser Feedbin
                            </button>
                            <span id="analyze-feedbin-instructions" class="instructions sr-only">
                                R√©cup√®re la liste de vos abonnements Feedbin pour pr√©parer la migration
                            </span>

                            <div id="cache-stats"></div>
                            <div id="feedbin-analysis" class="analysis-results hidden"></div>
                        </div>
                    </div>

                    <div class="step" id="step-3">
                        <div class="step-header">
                            <div class="step-number">3</div>
                            <h2>üöÄ Lancer la migration</h2>
                        </div>
                        <div class="step-content">
                            <p>Migration automatique de vos favoris vers Feedbin.</p>
                            
                            <button 
                                id="start-migration" 
                                class="btn btn-success" 
                                disabled
                                aria-label="D√©marrer la migration des favoris vers Feedbin"
                            >
                                üöÄ D√©marrer la migration
                            </button>

                            <!-- Progress will be created dynamically -->
                            <div id="migration-progress-container" class="hidden" role="status" aria-live="polite" aria-atomic="true"></div>
                            <div id="progress-text" class="progress-text">0%</div>

                            <div id="migration-results" class="results-container hidden"></div>
                        </div>
                    </div>

                    <div class="step" id="step-4">
                        <div class="step-header">
                            <div class="step-number">4</div>
                            <h2>üìä R√©sultats et actions</h2>
                        </div>
                        <div class="step-content">
                            <p>Analyse des r√©sultats et gestion des √©ventuels √©checs.</p>
                            
                            <div id="final-results" class="final-results hidden"></div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Onglet Activit√© (fusion statistiques + historique) -->
            <section id="activity" class="tab-content" role="tabpanel" aria-labelledby="tab-activity" tabindex="0" aria-hidden="true">
                <div class="activity-container">
                    <h2>üìä Mon activit√©</h2>
                    
                    <!-- Section Statistiques -->
                    <div class="stats-section">
                        <h3>üìà Vue d'ensemble</h3>
                        <div class="stats-grid">
                            <div class="stat-card">
                                <span class="stat-number" id="total-migrations">0</span>
                                <span class="stat-label">Migrations effectu√©es</span>
                            </div>
                            <div class="stat-card">
                                <span class="stat-number" id="total-favorites">0</span>
                                <span class="stat-label">Favoris migr√©s</span>
                            </div>
                            <div class="stat-card">
                                <span class="stat-number" id="success-rate">0%</span>
                                <span class="stat-label">Taux de r√©ussite</span>
                            </div>
                            <div class="stat-card">
                                <span class="stat-number" id="last-migration">-</span>
                                <span class="stat-label">Derni√®re migration</span>
                            </div>
                        </div>
                    </div>

                    <!-- Section Historique -->
                    <div class="history-section">
                        <div class="history-header">
                            <h3>üìã Historique d√©taill√©</h3>
                            <div class="history-controls">
                                <select id="activity-date-filter" class="form-select">
                                    <option value="7">7 derniers jours</option>
                                    <option value="30" selected>30 derniers jours</option>
                                    <option value="90">90 derniers jours</option>
                                    <option value="all">Tout l'historique</option>
                                </select>
                                <button id="refresh-activity" class="btn btn-primary">üîÑ Actualiser</button>
                                <button id="export-activity" class="btn btn-secondary">üìÑ Exporter</button>
                            </div>
                        </div>
                        <div id="activity-list" class="activity-list">
                            <p class="no-data">Aucune activit√© disponible</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Onglet Pr√©f√©rences -->
            <section id="preferences" class="tab-content" role="tabpanel" aria-labelledby="tab-preferences" tabindex="0" aria-hidden="true">
                <div class="preferences-container">
                    <h2>‚öôÔ∏è Mes pr√©f√©rences</h2>
                    <br class="preferences-intro">
                        Personnalisez le comportement de la migration selon vos besoins.</br>
                        Chaque option ci-dessous influence la fa√ßon dont vos favoris sont transf√©r√©s vers Feedbin.
                    </p>
                    <div class="settings-grid">
                        <div class="settings-card">
                            <h3>üîÑ Configuration migration</h3>
                            <form id="my-migration-config" class="settings-form">
                                <div class="form-group">
                                    <label for="my-max-retries">Tentatives max :</label>
                                    <input 
                                        type="number" 
                                        id="my-max-retries" 
                                        name="retry.maxAttempts" 
                                        min="1" 
                                        max="10" 
                                        value="3"
                                        aria-describedby="my-max-retries-desc"
                                    >
                                    <span id="my-max-retries-desc" class="option-desc">Nombre maximum de tentatives en cas d'√©chec lors de la migration d'un favori. Plus la valeur est √©lev√©e, plus l'outil essaiera de r√©essayer en cas d'erreur r√©seau ou API.</span>
                                </div>
                                <div class="form-group">
                                    <label for="my-batch-size">Taille des lots :</label>
                                    <input 
                                        type="number" 
                                        id="my-batch-size" 
                                        name="batchSize" 
                                        min="1" 
                                        max="50" 
                                        value="10"
                                        aria-describedby="my-batch-size-desc"
                                    >
                                    <span id="my-batch-size-desc" class="option-desc">Nombre d'articles favoris migr√©s en une seule requ√™te. Une valeur plus √©lev√©e acc√©l√®re la migration mais peut augmenter le risque d'erreur si la connexion est instable.</span>
                                </div>
                                <div class="form-group">
                                    <label for="my-fuzzy-threshold">
                                        Seuil de correspondance floue : 
                                        <span id="my-fuzzy-value" aria-live="polite">0.8</span>
                                    </label>
                                    <input 
                                        type="range" 
                                        id="my-fuzzy-threshold" 
                                        name="matching.fuzzyThreshold" 
                                        min="0.5" 
                                        max="1" 
                                        step="0.1" 
                                        value="0.8"
                                        aria-valuemin="0.5"
                                        aria-valuemax="1"
                                        aria-valuenow="0.8"
                                        aria-describedby="my-fuzzy-threshold-desc"
                                    >
                                    <span id="my-fuzzy-threshold-desc" class="option-desc">D√©termine la tol√©rance lors de la recherche de correspondance entre les flux FreshRSS et Feedbin. Plus la valeur est proche de 1, plus la correspondance doit √™tre exacte.</span>
                                </div>
                                <button type="submit" class="btn btn-primary">üíæ Sauvegarder</button>
                            </form>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Onglet Administration -->
            <section id="admin" class="tab-content" role="tabpanel" aria-labelledby="tab-admin" tabindex="0" aria-hidden="true">
                <div class="admin-container">
                    <h2>üîß Administration</h2>
                    <div class="admin-stats-grid">
                        <div class="stat-card">
                            <span class="stat-number" id="admin-total-users">0</span>
                            <span class="stat-label">Utilisateurs actifs</span>
                        </div>
                        <div class="stat-card">
                            <span class="stat-number" id="admin-total-migrations">0</span>
                            <span class="stat-label">Migrations totales</span>
                        </div>
                        <div class="stat-card">
                            <span class="stat-number" id="admin-success-rate">0%</span>
                            <span class="stat-label">Taux de r√©ussite global</span>
                        </div>
                        <div class="stat-card">
                            <span class="stat-number" id="admin-avg-duration">0s</span>
                            <span class="stat-label">Dur√©e moyenne</span>
                        </div>
                    </div>

                    <div class="admin-controls">
                        <button id="refresh-admin-stats" class="btn btn-primary" aria-label="Actualiser les statistiques d'administration">üîÑ Actualiser</button>
                        <button id="export-admin-data" class="btn btn-secondary" aria-label="Exporter les donn√©es d'administration">üìÑ Exporter donn√©es</button>
                        <button id="clear-logs" class="btn btn-danger" aria-label="Effacer les logs du syst√®me">üóëÔ∏è Effacer logs</button>
                    </div>
                </div>
            </section>
            </div>
        </main>
    </div>

    <!-- Scripts -->
    <!-- Load modular JavaScript files (api.js first as it's used by other modules) -->
    <script src="modules/api.js"></script>
    <script type="module" src="modules/auth.js"></script>
    <script type="module" src="modules/migration.js"></script>
    <script type="module" src="modules/ui.js"></script>
    <script type="module" src="modules/validation.js"></script>
    <script type="module" src="app.js"></script>
    <script type="module">
      import Card from '../../../../shared/components/Card/Card.js';
      import { FormGroup, FormInput, FormLabel, FormError } from '../../../../shared/components/Form/index.js';
      import Button from '../../../../shared/components/Button/Button.js';
      import Message from '../../../../shared/components/Message/Message.js';
      import Loader from '../../../../shared/components/Loader/Loader.js';
      import Header from '../../../../shared/components/Header/Header.js';
      import Footer from '../../../../shared/components/Footer/Footer.js';
      import Grid from '../../../../shared/components/Grid/Grid.js';
      import { Tabs, Tab } from '../../../../shared/components/Tabs/index.js';
      import { List, ListItem } from '../../../../shared/components/List/index.js';
      import Badge from '../../../../shared/components/Badge/Badge.js';
      import { ProgressBar, ProgressContainer } from '../../../../shared/components/Progress/index.js';
      import Modal from '../../../../shared/components/Modal/Modal.js';
      
      // Make components available globally
      window.SharedComponents = {
        Card,
        FormGroup,
        FormInput,
        FormLabel,
        FormError,
        Button,
        Message,
        Loader,
        Header,
        Footer,
        Grid,
        Tabs,
        Tab,
        List,
        ListItem,
        Badge,
        ProgressBar,
        ProgressContainer,
        Modal
      };

      // G√©n√©ration dynamique du dashboard avec composants mutualis√©s
      document.addEventListener('DOMContentLoaded', () => {
        const dashboard = document.getElementById('dashboard');
        if (!dashboard) return;
        dashboard.style.display = 'none'; // Masquer le dashboard natif

        // --- Onglet Migration (factoris√©) ---
        const step1 = Card({
          children: [
            Header({ title: 'üìÅ Charger les donn√©es FreshRSS', subtitle: '' }),
            'S√©lectionnez votre fichier ',
            document.createElement('code').appendChild(document.createTextNode('starred_entries.json')),
            ' export√© depuis FreshRSS.',
            // TODO: Uploader mutualis√©
          ]
        });
        const step2 = Card({
          children: [
            Header({ title: 'üîç Analyser les abonnements Feedbin', subtitle: '' }),
            'R√©cup√©ration de vos abonnements Feedbin pour pr√©parer la migration.',
            Button({ variant: 'primary', children: 'üîç Analyser Feedbin', disabled: true }),
            // TODO: Stats, analyses, etc.
          ]
        });
        const step3 = Card({
          children: [
            Header({ title: 'üöÄ Lancer la migration', subtitle: '' }),
            'Migration automatique de vos favoris vers Feedbin.',
            Button({ variant: 'success', children: 'üöÄ D√©marrer la migration', disabled: true }),
            ProgressContainer({
              children: [
                ProgressBar({ value: 0, max: 100 }),
                '0%'
              ]
            }),
            // TODO: R√©sultats, messages, etc.
          ]
        });
        const step4 = Card({
          children: [
            Header({ title: 'üìä R√©sultats et actions', subtitle: '' }),
            'Analyse des r√©sultats et gestion des √©ventuels √©checs.',
            // TODO: R√©sultats d√©taill√©s
          ]
        });
        const migrationSteps = Grid({ columns: 1, children: [step1, step2, step3, step4] });

        // --- Tabs ---
        const migrationTab = Tab({ label: 'üöÄ Migration', children: migrationSteps });

        // --- Onglet Activit√© (factoris√©) ---
        const statsCards = [
          Card({
            children: [
              Badge({ variant: 'primary', children: '0' }),
              'Migrations effectu√©es'
            ]
          }),
          Card({
            children: [
              Badge({ variant: 'success', children: '0' }),
              'Favoris migr√©s'
            ]
          }),
          Card({
            children: [
              Badge({ variant: 'info', children: '0%' }),
              'Taux de r√©ussite'
            ]
          }),
          Card({
            children: [
              Badge({ variant: 'gray', children: '-' }),
              'Derni√®re migration'
            ]
          })
        ];
        const statsSection = Card({
          children: [
            Header({ title: 'üìà Vue d\'ensemble', subtitle: '' }),
            Grid({ columns: 4, children: statsCards })
          ]
        });

        // Section historique
        const historyControls = FormGroup({
          children: [
            FormLabel({ htmlFor: 'activity-date-filter', children: 'P√©riode :' }),
            FormInput({
              id: 'activity-date-filter',
              type: 'select',
              children: [
                { value: '7', text: '7 derniers jours' },
                { value: '30', text: '30 derniers jours', selected: true },
                { value: '90', text: '90 derniers jours' },
                { value: 'all', text: 'Tout l\'historique' }
              ]
            }),
            Button({ variant: 'primary', children: 'üîÑ Actualiser' }),
            Button({ variant: 'secondary', children: 'üìÑ Exporter' })
          ]
        });

        const historyList = List({
          children: [
            ListItem({ children: 'Aucune activit√© disponible' })
          ]
        });

        const historySection = Card({
          children: [
            Header({ title: 'üìã Historique d√©taill√©', subtitle: '' }),
            historyControls,
            historyList
          ]
        });

        // Assemblage de l'onglet Activit√©
        const activityContent = Grid({
          columns: 1,
          children: [
            statsSection,
            historySection
          ]
        });

        // Mise √† jour des onglets
        const activityTab = Tab({ label: 'üìä Mon activit√©', children: activityContent });

        // --- Onglet Pr√©f√©rences (factoris√©) ---
        const preferencesForm = FormGroup({
          children: [
            FormGroup({
              children: [
                FormLabel({ htmlFor: 'my-max-retries', children: 'üîÑ Tentatives max :' }),
                FormInput({
                  id: 'my-max-retries',
                  type: 'number',
                  min: '1',
                  max: '10',
                  value: '3'
                }),
                'Nombre maximum de tentatives en cas d\'√©chec lors de la migration d\'un favori.'
              ]
            }),
            FormGroup({
              children: [
                FormLabel({ htmlFor: 'my-batch-size', children: 'üì¶ Taille des lots :' }),
                FormInput({
                  id: 'my-batch-size',
                  type: 'number',
                  min: '1',
                  max: '50',
                  value: '10'
                }),
                'Nombre d\'articles favoris migr√©s en une seule requ√™te.'
              ]
            }),
            FormGroup({
              children: [
                FormLabel({ htmlFor: 'my-fuzzy-threshold', children: 'üéØ Seuil de correspondance floue :' }),
                FormInput({
                  id: 'my-fuzzy-threshold',
                  type: 'range',
                  min: '0.5',
                  max: '1',
                  step: '0.1',
                  value: '0.8'
                }),
                'D√©termine la tol√©rance lors de la recherche de correspondance entre les flux.'
              ]
            }),
            Button({ variant: 'primary', children: 'üíæ Sauvegarder' })
          ]
        });

        const preferencesCard = Card({
          children: [
            Header({ title: '‚öôÔ∏è Configuration migration', subtitle: 'Personnalisez le comportement de la migration selon vos besoins.' }),
            preferencesForm
          ]
        });

        // Assemblage de l'onglet Pr√©f√©rences
        const preferencesContent = Grid({
          columns: 1,
          children: [preferencesCard]
        });

        // Mise √† jour des onglets
        const preferencesTab = Tab({ label: '‚öôÔ∏è Mes pr√©f√©rences', children: preferencesContent });

        // --- Onglet Administration (factoris√©) ---
        const adminStatsCards = [
          Card({
            children: [
              Badge({ variant: 'primary', children: '0' }),
              'Utilisateurs actifs'
            ]
          }),
          Card({
            children: [
              Badge({ variant: 'success', children: '0' }),
              'Migrations totales'
            ]
          }),
          Card({
            children: [
              Badge({ variant: 'info', children: '0%' }),
              'Taux de r√©ussite global'
            ]
          }),
          Card({
            children: [
              Badge({ variant: 'gray', children: '0s' }),
              'Dur√©e moyenne'
            ]
          })
        ];

        const adminControls = FormGroup({
          children: [
            Button({ variant: 'primary', children: 'üîÑ Actualiser' }),
            Button({ variant: 'secondary', children: 'üìÑ Exporter donn√©es' }),
            Button({ variant: 'error', children: 'üóëÔ∏è Effacer logs' })
          ]
        });

        const adminCard = Card({
          children: [
            Header({ title: 'üîß Administration', subtitle: 'Gestion globale du syst√®me' }),
            Grid({ columns: 4, children: adminStatsCards }),
            adminControls
          ]
        });

        // Assemblage de l'onglet Administration
        const adminContent = Grid({
          columns: 1,
          children: [adminCard]
        });

        // Mise √† jour des onglets
        const adminTab = Tab({ label: 'üîß Administration', children: adminContent });
        const tabs = Tabs({ children: [migrationTab, activityTab, preferencesTab, adminTab] });

        // Carte principale du dashboard
        const dashboardCard = Card({
          children: [
            Header({ title: 'Migration FreshRSS ‚Üí Feedbin', subtitle: '' }),
            tabs
          ]
        });

        // Insertion progressive
        let dashboardMount = document.getElementById('dashboard-mount');
        if (!dashboardMount) {
          dashboardMount = document.createElement('div');
          dashboardMount.id = 'dashboard-mount';
          document.body.appendChild(dashboardMount);
        }
        dashboardMount.innerHTML = '';
        dashboardMount.appendChild(dashboardCard);

        // Masquer l'ancien contenu
        const oldDashboard = document.getElementById('dashboard');
        const oldActivity = document.getElementById('activity');
        const oldPreferences = document.getElementById('preferences');
        const oldAdmin = document.getElementById('admin');
        [oldDashboard, oldActivity, oldPreferences, oldAdmin].forEach(el => {
          if (el) el.style.display = 'none';
        });
      });
      // TODO: Remplacer le contenu de chaque onglet par la structure factoris√©e (√©tapes, grilles, listes, etc.)
    </script>
</body>
</html> 